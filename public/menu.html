<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Menu - JaiDee Resort Restaurant</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--sand:#c9a96e;--sand-light:#e8d5a8;--dark:#1a1a1a;--bg:#faf8f4;--card:#fff;--text:#222;--dim:#999;--border:#eee;--success:#2e7d32;--ocean:#1a6b8a}
    body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);max-width:520px;margin:0 auto;padding-bottom:90px;min-height:100vh}

    /* Lang */
    .lang-strip{display:flex;justify-content:center;gap:4px;padding:8px 12px;background:var(--dark)}
    .lang-strip button{background:none;border:1px solid rgba(255,255,255,.15);color:rgba(255,255,255,.55);padding:3px 8px;border-radius:3px;font-size:10px;cursor:pointer}
    .lang-strip button.active{background:var(--sand);color:var(--dark);border-color:var(--sand)}

    /* Header */
    .menu-header{background:var(--dark);color:white;padding:20px 20px 16px;text-align:center}
    .menu-header .back{position:absolute;left:16px;top:48px;color:rgba(255,255,255,.5);text-decoration:none;font-size:13px}
    .menu-header h1{font-family:'Playfair Display',serif;font-size:22px;color:var(--sand);letter-spacing:2px}
    .menu-header p{font-size:11px;color:rgba(255,255,255,.5);margin-top:4px;letter-spacing:2px;text-transform:uppercase}

    /* Table */
    .table-row{background:white;padding:10px 16px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:90}
    .table-row label{font-size:13px;font-weight:600;color:var(--dim);white-space:nowrap}
    .table-row select{flex:1;padding:8px;border:1.5px solid var(--border);border-radius:6px;font-size:14px;font-family:inherit;background:white}

    /* Category nav */
    .cat-nav{display:flex;gap:6px;padding:10px 16px;overflow-x:auto;background:white;border-bottom:1px solid var(--border);position:sticky;top:46px;z-index:89}
    .cat-nav::-webkit-scrollbar{display:none}
    .cat-btn{padding:7px 16px;border:none;border-radius:20px;font-size:12px;font-weight:600;cursor:pointer;white-space:nowrap;background:#f0ece4;color:var(--dim);transition:.2s}
    .cat-btn.active{background:var(--dark);color:var(--sand)}

    /* Search */
    .search-bar{padding:10px 16px;background:var(--bg)}
    .search-bar input{width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:8px;font-size:14px;font-family:inherit;background:white}
    .search-bar input:focus{outline:none;border-color:var(--sand)}

    /* Menu grid */
    .menu-list{padding:8px 12px}
    .cat-title{font-family:'Playfair Display',serif;font-size:18px;padding:14px 4px 8px;color:var(--dark);border-bottom:1px solid var(--border);margin-bottom:8px}

    /* Card style: image left, info right for items with images; minimal for items without */
    .menu-item{background:var(--card);border-radius:10px;margin-bottom:8px;overflow:hidden;border:1px solid var(--border);transition:box-shadow .2s}
    .menu-item:hover{box-shadow:0 4px 12px rgba(0,0,0,.05)}
    .item-row{display:flex;align-items:stretch}
    .item-img{width:100px;min-height:80px;object-fit:cover;flex-shrink:0}
    .item-body{flex:1;padding:12px 14px;display:flex;flex-direction:column;justify-content:center;min-width:0}
    .item-name{font-weight:600;font-size:14px;line-height:1.3}
    .item-name-sub{font-size:11px;color:var(--sand);margin-top:1px}
    .item-desc{font-size:11px;color:var(--dim);margin-top:3px;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .item-bottom{display:flex;align-items:center;justify-content:space-between;margin-top:8px}
    .item-price{font-size:16px;font-weight:700;color:var(--ocean)}
    .item-actions{display:flex;align-items:center;gap:6px}
    .q-btn{width:28px;height:28px;border:none;border-radius:50%;font-size:16px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.15s}
    .q-btn.minus{background:#fff0f0;color:#c62828}
    .q-btn.plus{background:var(--dark);color:var(--sand)}
    .q-btn:active{transform:scale(.9)}
    .q-num{font-size:15px;font-weight:700;min-width:18px;text-align:center}

    /* Cart bar */
    .cart-bar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:520px;background:var(--dark);color:white;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;z-index:200;box-shadow:0 -4px 20px rgba(0,0,0,.15);transition:transform .3s}
    .cart-bar.hidden{transform:translateX(-50%) translateY(100%)}
    .cart-left .cart-count{font-size:13px;font-weight:600}
    .cart-left .cart-total{font-size:18px;font-weight:700;color:var(--sand)}
    .cart-btn{background:var(--sand);color:var(--dark);border:none;padding:10px 22px;border-radius:6px;font-size:14px;font-weight:700;cursor:pointer}

    /* Modal */
    .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:300;display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:.3s}
    .modal-bg.show{opacity:1;pointer-events:all}
    .modal{background:white;width:100%;max-width:520px;border-radius:18px 18px 0 0;padding:24px 20px 32px;transform:translateY(100%);transition:transform .3s;max-height:80vh;overflow-y:auto;position:relative}
    .modal-bg.show .modal{transform:translateY(0)}
    .modal h2{font-family:'Playfair Display',serif;font-size:20px;margin-bottom:14px}
    .modal-close{position:absolute;top:14px;right:18px;background:none;border:none;font-size:22px;cursor:pointer;color:var(--dim)}
    .modal-item{display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid #f5f5f5;font-size:14px}
    .modal-total{display:flex;justify-content:space-between;padding:14px 0;font-size:18px;font-weight:700;border-top:2px solid var(--dark);margin-top:8px}
    .modal-total .tp{color:var(--ocean)}
    .notes-ta{width:100%;padding:10px;border:1.5px solid var(--border);border-radius:8px;font-size:13px;font-family:inherit;resize:none;margin:10px 0}
    .order-btn{width:100%;padding:15px;background:var(--success);color:white;border:none;border-radius:10px;font-size:15px;font-weight:700;cursor:pointer;margin-top:6px}
    .order-btn:disabled{background:#ccc;cursor:not-allowed}

    /* Success */
    .success-screen{position:fixed;inset:0;background:white;z-index:400;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px;opacity:0;pointer-events:none;transition:.3s}
    .success-screen.show{opacity:1;pointer-events:all}
    .success-screen .check{font-size:72px;color:var(--success);margin-bottom:16px}
    .success-screen h2{font-family:'Playfair Display',serif;font-size:24px;margin-bottom:8px;color:var(--success)}
    .success-screen .oid{font-size:44px;font-weight:800;color:var(--ocean);margin:12px 0}
    .success-screen p{color:var(--dim)}
    .reset-btn{margin-top:28px;padding:13px 36px;background:var(--dark);color:var(--sand);border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer}
  </style>
</head>
<body>

<div class="lang-strip">
  <button class="active" onclick="setLang('en')">EN</button>
  <button onclick="setLang('th')">TH</button>
  <button onclick="setLang('zh')">中文</button>
  <button onclick="setLang('ru')">RU</button>
  <button onclick="setLang('ko')">KO</button>
  <button onclick="setLang('ja')">JA</button>
</div>

<div class="menu-header" style="position:relative">
  <a href="/" class="back" data-i18n="back">&larr; Resort</a>
  <h1>JAIDEE</h1>
  <p data-i18n="tagline">Fresh Seafood &bull; Beachfront Dining</p>
</div>

<div class="table-row">
  <label data-i18n="table_lbl">Table</label>
  <select id="tableSel"><option value="">Select table</option></select>
</div>

<div class="cat-nav" id="catNav"></div>
<div class="search-bar"><input type="text" id="searchInput" placeholder="Search menu..." oninput="renderMenu()"></div>
<div class="menu-list" id="menuList"></div>

<div class="cart-bar hidden" id="cartBar" onclick="openCart()">
  <div class="cart-left"><div class="cart-count" id="cartCount">0 items</div><div class="cart-total" id="cartTotal">฿0</div></div>
  <button class="cart-btn" data-i18n="view_order">View Order</button>
</div>

<div class="modal-bg" id="cartModal">
  <div class="modal">
    <button class="modal-close" onclick="closeCart()">&times;</button>
    <h2 data-i18n="your_order">Your Order</h2>
    <div id="cartItems"></div>
    <div class="modal-total"><span data-i18n="total">Total</span><span class="tp" id="modalTotal">฿0</span></div>
    <textarea class="notes-ta" id="orderNotes" rows="2" placeholder="Special instructions..."></textarea>
    <button class="order-btn" id="placeBtn" onclick="placeOrder()" data-i18n="place_order">Place Order</button>
  </div>
</div>

<div class="success-screen" id="successScreen">
  <div class="check">&#10003;</div>
  <h2 data-i18n="order_placed">Order Placed!</h2>
  <p data-i18n="order_number">Your order number</p>
  <div class="oid" id="orderId">#1</div>
  <p data-i18n="order_msg">Preparing your food. Sit back and enjoy the view!</p>
  <button class="reset-btn" onclick="resetOrder()" data-i18n="order_more">Order More</button>
</div>

<script>
let menu=[],cart={},lang="en",activeCat="all";
const langKeys={en:"name",th:"nameTh",zh:"nameZh",ru:"nameRu",ko:"nameKo",ja:"nameJa"};

const catLabels={
  en:{all:"All",starters:"Starters",mains:"Mains",drinks:"Drinks",desserts:"Desserts"},
  th:{all:"ทั้งหมด",starters:"อาหารเรียกน้ำย่อย",mains:"จานหลัก",drinks:"เครื่องดื่ม",desserts:"ของหวาน"},
  zh:{all:"全部",starters:"前菜",mains:"主菜",drinks:"饮料",desserts:"甜点"},
  ru:{all:"Все",starters:"Закуски",mains:"Основные",drinks:"Напитки",desserts:"Десерты"},
  ko:{all:"전체",starters:"전채",mains:"메인",drinks:"음료",desserts:"디저트"},
  ja:{all:"全て",starters:"前菜",mains:"メイン",drinks:"ドリンク",desserts:"デザート"},
};

const ui={
  en:{back:"\u2190 Resort",tagline:"Fresh Seafood &bull; Beachfront Dining",table_lbl:"Table",view_order:"View Order",your_order:"Your Order",total:"Total",place_order:"Place Order",order_placed:"Order Placed!",order_number:"Your order number",order_msg:"Preparing your food. Sit back and enjoy the view!",order_more:"Order More",search:"Search menu..."},
  th:{back:"\u2190 รีสอร์ท",tagline:"ซีฟู้ดสดๆ &bull; ทานริมทะเล",table_lbl:"โต๊ะ",view_order:"ดูออเดอร์",your_order:"ออเดอร์ของคุณ",total:"รวม",place_order:"สั่งอาหาร",order_placed:"สั่งอาหารสำเร็จ!",order_number:"หมายเลขออเดอร์",order_msg:"กำลังจัดเตรียมอาหาร นั่งพักผ่อนรอสักครู่ค่ะ!",order_more:"สั่งเพิ่ม",search:"ค้นหาเมนู..."},
  zh:{back:"\u2190 度假村",tagline:"新鲜海鲜 &bull; 海滨餐厅",table_lbl:"桌号",view_order:"查看订单",your_order:"您的订单",total:"合计",place_order:"下单",order_placed:"下单成功!",order_number:"您的订单号",order_msg:"正在准备您的美食，请稍候！",order_more:"继续点餐",search:"搜索菜单..."},
  ru:{back:"\u2190 Курорт",tagline:"Свежие морепродукты &bull; Ресторан на пляже",table_lbl:"Стол",view_order:"Заказ",your_order:"Ваш заказ",total:"Итого",place_order:"Оформить заказ",order_placed:"Заказ принят!",order_number:"Номер заказа",order_msg:"Готовим ваш заказ. Наслаждайтесь видом!",order_more:"Заказать ещё",search:"Поиск..."},
  ko:{back:"\u2190 리조트",tagline:"신선한 해산물 &bull; 비치프론트 다이닝",table_lbl:"테이블",view_order:"주문 보기",your_order:"주문 내역",total:"합계",place_order:"주문하기",order_placed:"주문 완료!",order_number:"주문 번호",order_msg:"음식을 준비하고 있습니다. 잠시만 기다려주세요!",order_more:"추가 주문",search:"메뉴 검색..."},
  ja:{back:"\u2190 リゾート",tagline:"新鮮なシーフード &bull; ビーチフロントダイニング",table_lbl:"テーブル",view_order:"注文を見る",your_order:"ご注文",total:"合計",place_order:"注文する",order_placed:"注文完了!",order_number:"注文番号",order_msg:"お料理を準備しています。景色をお楽しみください!",order_more:"追加注文",search:"メニュー検索..."},
};

// Table options
const tsel=document.getElementById("tableSel");
for(let i=1;i<=20;i++){const o=document.createElement("option");o.value=i;o.textContent=`Table ${i}`;tsel.appendChild(o)}
const tp=new URLSearchParams(location.search).get("table");
if(tp)tsel.value=tp;

// Fetch menu
fetch("/api/menu").then(r=>r.json()).then(d=>{menu=d;renderCats();renderMenu()});

function setLang(l){
  lang=l;
  document.querySelectorAll(".lang-strip button").forEach(b=>b.classList.remove("active"));
  document.querySelector(`.lang-strip button[onclick="setLang('${l}')"]`).classList.add("active");
  const u=ui[l];
  document.querySelectorAll("[data-i18n]").forEach(el=>{if(u[el.dataset.i18n])el.innerHTML=u[el.dataset.i18n]});
  document.getElementById("searchInput").placeholder=u.search;
  renderCats();renderMenu();updateCart();
}

function getName(item){return item[langKeys[lang]]||item.name}

function renderCats(){
  const cats=["all",...new Set(menu.map(i=>i.category))];
  const cl=catLabels[lang]||catLabels.en;
  document.getElementById("catNav").innerHTML=cats.map(c=>
    `<button class="cat-btn ${c===activeCat?'active':''}" onclick="filterCat('${c}')">${cl[c]||c}</button>`
  ).join("");
}

function filterCat(c){activeCat=c;renderCats();renderMenu()}

function renderMenu(){
  const q=document.getElementById("searchInput").value.toLowerCase();
  let items=activeCat==="all"?menu:menu.filter(i=>i.category===activeCat);
  if(q)items=items.filter(i=>getName(i).toLowerCase().includes(q)||i.name.toLowerCase().includes(q)||i.description.toLowerCase().includes(q));

  const grouped={};
  items.forEach(i=>{if(!grouped[i.category])grouped[i.category]=[];grouped[i.category].push(i)});
  const cl=catLabels[lang]||catLabels.en;

  let html="";
  for(const[cat,list]of Object.entries(grouped)){
    html+=`<div class="cat-title">${cl[cat]||cat}</div>`;
    list.forEach(item=>{
      const qty=cart[item.id]||0;
      const hasImg=item.image&&item.image.length>0;
      html+=`<div class="menu-item"><div class="item-row">
        ${hasImg?`<img src="${item.image}" class="item-img" alt="">`:''}
        <div class="item-body">
          <div class="item-name">${getName(item)}</div>
          ${lang!=="en"?`<div class="item-name-sub">${item.name}</div>`:''}
          <div class="item-desc">${item.description}</div>
          <div class="item-bottom">
            <div class="item-price">฿${item.price}</div>
            <div class="item-actions">
              ${qty>0?`<button class="q-btn minus" onclick="chg(${item.id},-1)">-</button><span class="q-num">${qty}</span>`:''}
              <button class="q-btn plus" onclick="chg(${item.id},1)">+</button>
            </div>
          </div>
        </div>
      </div></div>`;
    });
  }
  document.getElementById("menuList").innerHTML=html||`<div style="text-align:center;padding:40px;color:#ccc">No items found</div>`;
}

function chg(id,d){cart[id]=Math.max(0,(cart[id]||0)+d);if(cart[id]===0)delete cart[id];renderMenu();updateCart()}

function updateCart(){
  const ids=Object.keys(cart);
  const n=Object.values(cart).reduce((s,q)=>s+q,0);
  const t=ids.reduce((s,id)=>{const i=menu.find(m=>m.id===+id);return s+(i?i.price*cart[id]:0)},0);
  const bar=document.getElementById("cartBar");
  if(n===0){bar.classList.add("hidden")}else{
    bar.classList.remove("hidden");
    document.getElementById("cartCount").textContent=`${n} item${n>1?'s':''}`;
    document.getElementById("cartTotal").textContent=`฿${t}`;
  }
}

function openCart(){
  let html="",total=0;
  for(const[id,qty]of Object.entries(cart)){
    const item=menu.find(m=>m.id===+id);
    const sub=item.price*qty;total+=sub;
    html+=`<div class="modal-item"><span>${getName(item)} x${qty}</span><span>฿${sub}</span></div>`;
  }
  document.getElementById("cartItems").innerHTML=html;
  document.getElementById("modalTotal").textContent=`฿${total}`;
  document.getElementById("cartModal").classList.add("show");
}
function closeCart(){document.getElementById("cartModal").classList.remove("show")}

async function placeOrder(){
  if(!tsel.value){alert(lang==="th"?"กรุณาเลือกโต๊ะ":"Please select your table");closeCart();return}
  const btn=document.getElementById("placeBtn");btn.disabled=true;btn.textContent="...";
  const items=Object.entries(cart).map(([id,qty])=>{const i=menu.find(m=>m.id===+id);return{id:i.id,name:i.name,price:i.price,quantity:qty}});
  try{
    const r=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableNumber:+tsel.value,items,notes:document.getElementById("orderNotes").value})});
    const d=await r.json();
    closeCart();document.getElementById("orderId").textContent=`#${d.orderId}`;document.getElementById("successScreen").classList.add("show");
  }catch(e){alert("Failed. Try again.")}
  btn.disabled=false;btn.textContent=ui[lang].place_order;
}

function resetOrder(){cart={};document.getElementById("orderNotes").value="";document.getElementById("successScreen").classList.remove("show");renderMenu();updateCart()}
document.getElementById("cartModal").addEventListener("click",function(e){if(e.target===this)closeCart()});
</script>
</body>
</html>
